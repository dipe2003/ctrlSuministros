<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" 
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <link rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/Resources/CSS/base.css"/>
        <link rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/Resources/CSS/jquery-ui.css"/>
        
        <script src="#{facesContext.externalContext.requestContextPath}/Resources/Scripts/jquery-1.11.3.min.js"/>
        <script src="#{facesContext.externalContext.requestContextPath}/Resources/Scripts/jquery-ui-1.11.4.azul.verde/jquery-ui.min.js"/>
        <script src="#{facesContext.externalContext.requestContextPath}/Resources/Scripts/Datepicker.js"/>
        <script src="#{facesContext.externalContext.requestContextPath}/Resources/Scripts/AgregarSuministro.js"/>
        <script src="#{facesContext.externalContext.requestContextPath}/Resources/Scripts/RegistrarIngresoSuministro.js"/>
        <script src="#{facesContext.externalContext.requestContextPath}/Resources/Scripts/RegistrarSalidaSuministro.js"/>
        
        <script src="#{facesContext.externalContext.requestContextPath}/Resources/Scripts/Chart.js"/>
        
        <Script>
            $(document).ready(function() {
                var datosStock = [
                    {
                        value: #{graficosIndex.totalSuministrosDebajoStockMinimo},
                        color:"#F7464A",
                        highlight: "#FF5A5E",
                        label: "Debajo Stock Minimo"
                    },
                    {
                        value: #{graficosIndex.totalSuministrosRegistrados - graficosIndex.totalSuministrosDebajoStockMinimo},
                        color: "#86B559",
                        highlight: "#9AC949",
                        label: "Con Stock"
                    }                    
                ];
                var datosVencimiento = [
                    {
                        value: #{graficosIndex.totalSuministrosLotesVencidosStock},
                        color:"#F7464A",
                        highlight: "#FF5A5E",
                        label: "Vencidos"
                    },
                    {
                        value: #{graficosIndex.totalSuministrosRegistrados - graficosIndex.totalSuministrosLotesVencidosStock},
                        color: "#86B559",
                        highlight: "#9AC949",
                        label: "Vigentes"
                    }                    
                ];
                var opciones = {
                    animationSteps : 200
                };
                /*
                 * myDoughnutChart.addData({
                    value: 130,
                    color: "#B48EAD",
                    highlight: "#C69CBE",
                    label: "Purple"
                });
                 */
                // Get context with jQuery - using jQuery's .get() method.
                var ctx = $("#myChart").get(0).getContext("2d");
                var ctx2 = $("#myChartVenc").get(0).getContext("2d");
                // This will get the first returned node in the jQuery collection.
                var StockChart = new Chart(ctx).Pie(datosStock, opciones);
                var VencimientoChart = new Chart(ctx2).Pie(datosVencimiento, opciones);

            });
        </Script>
        <title>Inicio</title>
    </h:head>
    <h:body>
        <div>
            <ui:include src="header.xhtml"/>
        </div>
        <div>
            <ui:include src="menu.xhtml"/>
        </div>
        <div class="contentBody">
            <ui:insert name="page_content">
                <div class="contenido">
                    <h:form id="frmIndexSuministro">
                        <fieldset><legend>Resumen</legend>
                            <div class="label">Suministro</div>
                            <h:selectOneMenu id="selectSuministroIndex" value="#{datosIndex.idSuministroSeleccionado}" class="select-opt-menu" required="true" requiredMessage="No se selecciono tipo." >
                                <f:selectItem itemValue="--Seleccionar Suministro---"  itemDisabled="false"  noSelectionOption="true"  />
                                <f:selectItems value="#{datosIndex.mapSuministros}" />
                                <f:ajax listener="#{datosIndex.cargarDatosSuministro()}" render="outputCantidadStockLoteIndex outputUltimoIngresoIndex outputUltimoIngresoCantidadIndex contenedorInfoIndex" />
                            </h:selectOneMenu>
                            <h:panelGroup id="contenedorInfoIndex">
                                <h:panelGroup rendered="#{datosIndex.idSuministroSeleccionado != 0 and (datosIndex.suministro.ultimoIngreso == null)}">
                                    <div class="info">Todav√≠a no hay registro de ingresos de este suministro.</div>
                                </h:panelGroup>
                                
                                <h:panelGroup id="infoIndex" rendered="#{datosIndex.idSuministroSeleccionado != 0 and not (datosIndex.suministro.ultimoIngreso == null)}">                                   
                                    <div class="label">Stock Actual</div>
                                    <h:inputText id="outputCantidadStockLoteIndex" class="output" value="#{datosIndex.stockSuministro} #{datosIndex.unidadCantidad}" pt:disabled="true" />
                                    
                                    <div class="label">Ultimo Ingreso</div>
                                    <h:inputText id="outputUltimoIngresoIndex" class="output" value="El #{datosIndex.suministro.ultimoIngreso.fechaIngreso} / Numero de Lote: #{datosIndex.suministro.ultimoIngreso.loteIngreso.numeroLote}" pt:disabled="true" />
                                    <h:inputText id="outputUltimoIngresoCantidadIndex" class="output" value="#{datosIndex.suministro.ultimoIngreso.cantidadIngreso} #{datosIndex.unidadCantidad}" pt:disabled="true" />
                                </h:panelGroup>
                            </h:panelGroup>
                        </fieldset>
                        
                        <fieldset><legend>Graficos</legend>
                            <div class="contenedor-5050">
                                <canvas id="myChart" width="300" height="200" class="contenedor-50"></canvas>                                   
                                <canvas id="myChartVenc" width="300" height="200" class="contenedor-50"></canvas>                                   
                            </div>
                        </fieldset>
                        <fieldset><legend>Detalles</legend>
                            <div class="contenedor-5050">
                                <div class="contenedor-50">
                                    <div class="label">Detalles Stock</div>
                                    <f:view>
                                        <h:form>
                                            <h:dataTable value="#{datosIndex.listSuministrosDebajoStock}" var="SuministroStock" style="text-align: left;">
                                                <h:column >
                                                    <f:facet name="header">Suministro</f:facet>    	
                                                    <h:outputText value="#{SuministroStock.nombreSuministro}" />
                                                </h:column>                                                
                                                <h:column >
                                                    <f:facet name="header">Stock</f:facet> 
                                                    <h:outputText value="#{SuministroStock.stock} #{SuministroStock.unidadSuministro.nombreUnidad}"/>
                                                </h:column>                                                
                                            </h:dataTable>
                                        </h:form>
                                    </f:view>                                    
                                </div>                                   
                                <div class="contenedor-50">
                                    <div class="label">Detalles Vencimiento</div>
                                    <f:view>
                                        <h:form>
                                            <h:dataTable value="#{datosIndex.listSuministrosVencidos}" var="item" style="text-align: left;">
                                                <h:column >
                                                     <f:facet name="header">Suministro</f:facet>
                                                    <h:outputText value="#{item.nombreSuministro}" />
                                                  </h:column>                                                
                                                <h:column >
                                                     <f:facet name="header">Fecha</f:facet>                                                     
                                                    FechaVencimiento
                                                </h:column>
                                            </h:dataTable>
                                        </h:form>
                                    </f:view>
                                    
                                </div>                                   
                            </div>
                        </fieldset>
                    </h:form>
                </div>
            </ui:insert>
        </div>
    </h:body>
</html>

